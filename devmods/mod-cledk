##
## ** mod-cledk: functions to assist CLE development process **
#
#* version: 2019-03-12
#* author:  Michael Arbet (marbet@redhat.com)
#* home:    https://github.com/micharbet/CLE
#* license: GNU GPL v2
#* Copyright (C) 2017-2018 by Michael Arbet
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.

# where I do development
CLE_DK=$HOME/d/CLE

## `cle e [mod]`    - edit clerc file ev. specified module
_cle_e () (
	local F=$CLE_DK/clerc.sh
	[ -n "$1" ] && F=`ls $CLE_DK/modules/* $CLE_DK/devmods/* 2>/dev/null | grep $1`
	case `wc -w <<<$F` in
	0)
		echo no such file: $1
		return 1;;
	1)
		vim $F;;
	*)
		PS3="$_CL choose file # $_CN"
		select FF in $F; do
			[ -n "$FF" ] && break
		done
		vim $FF
		;;
	esac
)

## `cle cp [short]` - copy and run new development version of clerc
_cle_cp() {
	[ $1 ] || CLERS="$CLE_DK/clerc.sh $CLE_RC"
	[[ $1 =~ ^s ]] && CLERS="$CLE_DK/clerc $CLE_RC"
	eval diff $CLERS
	eval ls -lL $CLERS
	ask "replace clerc?" && { cp $CLE_RC $CLE_RC.bkdev; eval cp $CLERS; cle reload; }
}

## `cle func`       - list all current bash functions
_cle_func () {
	declare -f |sed -n '/_cle.\+\s()/p'
}

## `cdc`            - shortcut into $HOME/d/cle
cdc () {
	cd $CLE_DK
	printb CLE development kit: $PWD
	git status
}

## `cle commit`     - commit changes into git (also generate clerc from clerc.sh
_cle_commit () (
	# generate short version of CLE
	make
	gicom $1
)

## `cle modln`      - symlink module from $CLE_DK
_cle_modln () (
	F=`ls $CLE_DK/modules/* $CLE_DK/devmods/* 2>/dev/null | grep $1`
	case `wc -w <<<$F` in
	0)
		echo no such module: $1
		return 1;;
	1)
		FF=$F;;
	*)
		PS3="$_CL choose module # $_CN"
		select FF in $F; do
			[ -n "$FF" ] && break
		done
		;;
	esac
	echo Linking $FF
	ln -sf $FF $CLE_D
	cle reload
)


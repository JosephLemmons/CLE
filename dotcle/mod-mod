##
## mod-mod: CLE module management
## ------------------------------

# Copyright (C) 2017 by Michael Arbet
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.


_cle_mod () {
	case "$1" in
	list)	## cle mod list    -- list installed modules
		local M MM
		printb Modules installed in $HOME/.cle
		for M in $HOME/.cle/mod-*; do
			MM=`basename $M`
			local DESC=`grep "## $MM:" $M | sed "s/^## $MM:\s*//"`
			echo $MM: $DESC
		done
		;;
	avail*) ## cle mod avail   -- list modules available in repository
		printb Modules available in repository
		printb CLE_SRC= $CLE_SRC
		curl -k $CLE_SRC/dotcle/modlist
		;;
	get)	## cle mod get     -- install module from repository
		local MODLIST=$HOME/.cle/modlist
		curl -k $CLE_SRC/dotcle/modlist >$MODLIST
		PS3="$CT_L choose module $CT_N"
		select MM in `cat $MODLIST`; do
			echo downloading $MM
			curl -k $CLE_SRC/dotcle/$MM >$HOME/.cle/$MM
			echo executing module
			_clexe $HOME/.cle/$MM
			break
		done
		;;
	help)
		_hlp ${BASH_SOURCE[0]}
		;;
	*)
		printb "cle mod $1: nothing to do..."
		return 1
		;;
	esac
}
